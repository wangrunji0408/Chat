## 业务需求

* 用户

  * 注册与登陆
    * 注册：提供用户名和密码，用户名必须唯一，之后分配唯一不变id
    * 登陆：提供用户名和密码
  * 属性/信息
    * 访问级别：公开，好友访问，私有
  * 人际关系
    * `陌生人`
      * 不能私聊
      * 互相可以访问`公开信息`
    * `好友`
      * 成为好友需由一方申请，另一方接受
      * 互相可以访问`对好友公开的信息`
      * 可以私聊
      * 可以单方面`屏蔽`对方，等效于临时成为陌生人，可由本人解除屏蔽

* 聊天室

  * 包含若干`用户`

    * 每个用户在群中有自己的属性
      * 公开：昵称……
      * 私有设置：提示等级……

  * `消息`

    * 正常状态下，每个用户可以向聊天室中发消息，其它用户可以接收到消息
    * 消息有很多种类：文本、图片、语音、红包……
    * 消息可以在规定时间内由发送者撤回

  * 身份及操作

    除发送消息外，每个成员可以进行一些操作，以修改聊天室状态。操作权限与身份挂钩。每个操作可能引发一些事件，某些事件需要在群中广播。

    * `普通成员`：
      * 退群，不需经过任何人同意
      * 修改自己在群聊中的属性
    * `管理员`：每个聊天室有一个或多个，有特殊权限：
      * 添加成员，所加成员必须是管理员好友
      * 剔出成员，只能是普通成员
      * 发布群公告
      * 修改群属性
    * `群主`：有且只有一个，有管理员权限，除此之外：
      * 剔出管理员
      * 设置其他人的权限，即任免管理员
      * 转让群主
      * 解散群聊，此后群状态冻结，所有人不能进行任何操作
    * ※`非成员`：
      * 申请入群，所有管理员会接到通知，管理员可以不回应，以第一个回应为准
      * 新建群，指定若干好友作为初始成员，建群者默认成为群主

  * `私聊`

    * 私聊是特殊的聊天室，有且只有两人，永远不变
    * 当两人成为好友后，系统自动分配私聊
    * 私聊只能发消息，没有身份和操作
    * 当其中一人屏蔽另一人，或解除好友关系后，私聊冻结，双方均不能发消息

## 领域模型

### 身份上下文

#### 实体

* 用户

#### 服务

* 注册与登录服务

### 聊天上下文

#### 实体

* A用户
  * E用户关系
* A聊天室
  * E用户在聊天室属性
* V消息
* V操作

#### 事件

* 聊天室事件

#### 服务

* 好友申请服务

* 用户信息生成服务
* 聊天室信息生成服务

